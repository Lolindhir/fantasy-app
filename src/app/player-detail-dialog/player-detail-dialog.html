<h2 mat-dialog-title class="player-dialog-title">
  <div class="dialog-header">
    <img class="dialog-player-logo" [src]="player.Picture" alt="{{ player.TeamNFL.Name }}" />

    <div class="dialog-player-info">
      <span class="dialog-player-name">{{ player.Name }}</span>
      <div *ngIf="rankingCombined != undefined" class="dialog-rankings">
        <span>#{{ rankingCombined }} <small>Overall</small></span>
        <span>#{{ rankingCombinedPosition }} <small>Pos</small></span>
      </div>
    </div>

    <button mat-icon-button (click)="close()" class="dialog-close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>
</h2>

<mat-dialog-content class="dialog-content">

  <!-- ðŸˆ Overview Tab -->
  <mat-tab-group>
    <mat-tab label="Overview">
      <div class="dialog-overview">

        <div class="dialog-info">

          <div class="dialog-team">
            <img *ngIf="player.TeamNFL?.Logo" [src]="player.TeamNFL.Logo" alt="Logo" class="dialog-team-logo" />
            <span>{{ player.TeamNFL.Name }} ({{ player.Position }} #{{ player.Number }})</span>
          </div>

          <div class="dialog-player-details">
            <div *ngIf="player.TeamFantasy">
              <span class="label">Fantasy Team:</span>
              <strong>{{ player.TeamFantasy.Team }}</strong>
            </div>
            <div>
              <span class="label">Alter:</span> {{ player.Age }}
              <span class="label"> | Jahr:</span> {{ player.Year }}
            </div>
            <div>
              <span class="label">College:</span> {{ player.College }}
            </div>
            <div>
              <span class="label">Gehalt:</span> <strong>{{ player.SalaryDollarsDisplay }}</strong>
            </div>
            <div>
              <span class="label">Projiziert:</span> {{ player.SalaryDollarsProjectedDisplay }}
            </div>
          </div>

          <div class="dialog-status-chip">
            <mat-chip-listbox aria-label="Status">
              <mat-chip [color]="player.Injured ? 'warn' : 'primary'" selected>
                {{ player.Injured ? player.InjuryDetails.Designation : 'Active' }}
              </mat-chip>
            </mat-chip-listbox>
          </div>

        </div>
      </div>
    </mat-tab>

    <!-- ðŸ“Š Stats Tab -->
    <mat-tab label="Stats">
      <div class="dialog-stats-grid">
        <div><strong>Games Played:</strong> {{ player.Stats.GamesPlayed }}</div>
        <div><strong>Snaps Played:</strong> {{ player.Stats.SnapsTotal }}</div>
        <div><strong>Attempts:</strong> {{ player.Stats.AttemptsTotal }}</div>
        <div><strong>Fantasy Pts:</strong> {{ player.Stats.FantasyPointsTotal | number:'1.0-2' }}</div>
        <div><strong>Avg/Game:</strong> {{ player.Stats.FantasyPointsAvgGame | number:'1.1-2' }}</div>
        <div *ngIf="player.Stats.TouchdownsTotal > 0"><strong>Total Touchdowns:</strong> {{ player.Stats.TouchdownsTotal | number }}</div>
        <div *ngIf="player.Stats.TouchdownsReceiving > 0"><strong>Receiving Touchdowns:</strong> {{ player.Stats.TouchdownsReceiving | number }}</div>
        <div *ngIf="player.Stats.TouchdownsRushing > 0"><strong>Rushing Touchdowns:</strong> {{ player.Stats.TouchdownsRushing | number }}</div>
        <div *ngIf="player.Stats.TouchdownsPassing > 0"><strong>Passing Touchdowns:</strong> {{ player.Stats.TouchdownsPassing | number }}</div>
      </div>

      <div class="stats-buttons">
        <a [href]="player.FantasyPros" target="_blank">FantasyPros</a>
        <a [href]="player.ESPN" target="_blank">ESPN</a>
      </div>
    </mat-tab>

    <!-- ðŸ§¾ Game Log -->
    <mat-tab label="Game Log" *ngIf="player.GameHistoryFull?.length">
      <table mat-table [dataSource]="player.GameHistoryFull ?? []" class="mat-elevation-z1">

        <!-- Week -->
        <ng-container matColumnDef="week">
          <th mat-header-cell *matHeaderCellDef>Week</th>
          <td mat-cell *matCellDef="let g"
              [ngClass]="{
                'gameWeekNotScored': !g.GameDetails.WeekScored,
                'gameWeekPlayoff': g.GameDetails.WeekPlayoff
              }">
            {{ g.GameDetails.Week }}
          </td>
        </ng-container>

        <!-- Opponent -->
        <ng-container matColumnDef="opponent">
          <th mat-header-cell *matHeaderCellDef>Opponent</th>
          <td mat-cell *matCellDef="let g">
            <ng-container *ngIf="g.GameDetails.Home !== '-'">
              <ng-container *ngIf="g.GameDetails.HomeID === player.TeamNFL.ID">
                vs {{ g.GameDetails.Away }}
              </ng-container>
              <ng-container *ngIf="g.GameDetails.AwayID === player.TeamNFL.ID">
                @ {{ g.GameDetails.Home }}
              </ng-container>
            </ng-container>
            <ng-container *ngIf="g.GameDetails.Home === '-'">â€“</ng-container>
          </td>
        </ng-container>

        <!-- Fantasy Points -->
        <ng-container matColumnDef="points">
          <th mat-header-cell *matHeaderCellDef>Points</th>
          <td mat-cell *matCellDef="let g">{{ g.FantasyPoints <= 0 ? 'â€“' : g.FantasyPoints }}</td>
        </ng-container>

        <!-- Touchdowns -->
        <ng-container matColumnDef="touchdowns">
          <th mat-header-cell *matHeaderCellDef>TDs</th>
          <td mat-cell *matCellDef="let g">
            <ng-container *ngIf="g.Passing || g.Rushing || g.Receiving; else dash">
              {{
                (g.Passing?.PassTDs ?? 0) +
                (g.Rushing?.RushTDs ?? 0) +
                (g.Receiving?.ReceptionTDs ?? 0)
              }}
            </ng-container>
            <ng-template #dash>â€“</ng-template>
          </td>
        </ng-container>

        <!-- Field Goals -->
        <ng-container matColumnDef="fgs">
          <th mat-header-cell *matHeaderCellDef>FGs</th>
          <td mat-cell *matCellDef="let g">
            <ng-container *ngIf="g.Kicking; else dash">
              {{ g.Kicking.FgMade }}/{{ g.Kicking.FgAttempts }}
            </ng-container>
            <ng-template #dash>â€“</ng-template>
          </td>
        </ng-container>

        <!-- Extra Points -->
        <ng-container matColumnDef="xps">
          <th mat-header-cell *matHeaderCellDef>XPs</th>
          <td mat-cell *matCellDef="let g">
            <ng-container *ngIf="g.Kicking; else dash">
              {{ g.Kicking.XpMade }}/{{ g.Kicking.XpAttempts }}
            </ng-container>
            <ng-template #dash>â€“</ng-template>
          </td>
        </ng-container>

        <ng-container *ngIf="player.Position != 'K'">
          <tr mat-header-row *matHeaderRowDef="['week','opponent','points','touchdowns']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['week','opponent','points','touchdowns']"></tr>
        </ng-container>

        <ng-container *ngIf="player.Position === 'K'">
          <tr mat-header-row *matHeaderRowDef="['week','opponent','points','fgs','xps']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['week','opponent','points','fgs','xps']"></tr>
        </ng-container>
      </table>
    </mat-tab>

    <!-- ðŸ“ˆ History Tab -->
    <mat-tab label="History">
      <div class="dialog-history-table">
        <table mat-table [dataSource]="getDefinedSeasons(player.Stats)">
          <ng-container matColumnDef="season">
            <th mat-header-cell *matHeaderCellDef>Season</th>
            <td mat-cell *matCellDef="let row">{{ row.Season }}</td>
          </ng-container>

          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef>Total</th>
            <td mat-cell *matCellDef="let row">{{ row.Total }}</td>
          </ng-container>

          <ng-container matColumnDef="avgGame">
            <th mat-header-cell *matHeaderCellDef>Avg/Game</th>
            <td mat-cell *matCellDef="let row">{{ row.AvgGame }}</td>
          </ng-container>

          <ng-container matColumnDef="games">
            <th mat-header-cell *matHeaderCellDef>Games</th>
            <td mat-cell *matCellDef="let row">{{ row.GamesPlayed }}/{{ row.PotentialGames }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['season','total','avgGame','games']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['season','total','avgGame','games']"></tr>
        </table>
      </div>
    </mat-tab>

    <!-- ðŸ©¹ Injury Tab -->
    <mat-tab *ngIf="player.Injured && player.InjuryDetails" label="Injury">
      <div class="dialog-injury">
        <p><strong>{{ player.InjuryDetails.Description }}</strong></p>
        <p *ngIf="player.InjuryDetails.Designation"><strong>Designation:</strong> {{ player.InjuryDetails.Designation }}</p>
        <p *ngIf="player.InjuryDetails.ReturnDate"><strong>Expected Return Date:</strong> {{ player.InjuryDetails.ReturnDate | date }}</p>
      </div>
    </mat-tab>

  </mat-tab-group>
</mat-dialog-content>
